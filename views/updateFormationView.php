<?php
$disquette = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-floppy" viewBox="0 0 16 16">
  <path d="M11 2H9v3h2z"/>
  <path d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0M1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5m3 4a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V1H4zM3 15h10v-4.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5z"/>
</svg>';

$retour = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-bar-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M12.5 15a.5.5 0 0 1-.5-.5v-13a.5.5 0 0 1 1 0v13a.5.5 0 0 1-.5.5M10 8a.5.5 0 0 1-.5.5H3.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L3.707 7.5H9.5a.5.5 0 0 1 .5.5"/>
</svg>';

$cle = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-wrench-adjustable" viewBox="0 0 16 16">
  <path d="M16 4.5a4.5 4.5 0 0 1-1.703 3.526L13 5l2.959-1.11q.04.3.041.61"/>
  <path d="M11.5 9c.653 0 1.273-.139 1.833-.39L12 5.5 11 3l3.826-1.53A4.5 4.5 0 0 0 7.29 6.092l-6.116 5.096a2.583 2.583 0 1 0 3.638 3.638L9.908 8.71A4.5 4.5 0 0 0 11.5 9m-1.292-4.361-.596.893.809-.27a.25.25 0 0 1 .287.377l-.596.893.809-.27.158.475-1.5.5a.25.25 0 0 1-.287-.376l.596-.893-.809.27a.25.25 0 0 1-.287-.377l.596-.893-.809.27-.158-.475 1.5-.5a.25.25 0 0 1 .287.376M3 14a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
</svg>';

$pdf = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-pdf" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z"/>
</svg>';

$upload = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">
  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
  <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>
</svg>';

$plus = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
  <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
</svg>';
/*---------------------------------------------------------------*/
if (!empty($_SESSION['name'])) {

//A. 1ST VERIFICATION
    if (!empty($_GET['id_formation'])) {
        $params = $id = [$_GET['id_formation']];

        //B. CONNEXION & QUERY
        /* *** 1. connexion *** */
        global $connexion;
        $connexion = connexion();

        /* *** 2.query *** */
        $query = $connexion->prepare("SELECT COUNT(*) FROM formations WHERE id_formation = ?");

        /* *** 3.execute *** */
        $query->execute($params);

        //VERIFICATION ID NON EXISTANT
        if ($query->fetchColumn() == 0) {
            $_SESSION['alert'] = "&#9940; La formation avec l'ID fourni n'existe pas. &#9940;";
            $_SESSION['alert-color'] = 'danger';
            header('Location: index.php?sent=views/arrayFormations');
            die;
        }

        $query = $connexion->prepare('SELECT * FROM formations WHERE id_formation = ?');
        $query->execute($params);

        /* *** 4. fetch *** */
        $formation = $query->fetch(PDO::FETCH_ASSOC);

        if ($formation) {
            ?>

            <div class="container">
                <img src="picturesWeb/logo.png" class="logo" alt="Logo">
                <h2>MODIFIER UNE FORMATION A LEARNZONE <?php echo $cle ?></h2><br>

                <form action="index.php?sent=app/updateFormation" method="post" enctype="multipart/form-data">
                    <div>
                        <input type="hidden" name="id" value="<?php echo $formation['id_formation'] ?>">
                        <input class="form-control" type="text" name="name"
                               value="<?php echo $formation['nom_formation'] ?>"><br>
                        <input class="form-control" type="text" name="duree"
                               value="<?php echo $formation['duree_formation'] ?>"><br>
                        <input class="form-control" type="text" name="enseignant"
                               value="<?php echo $formation['nom_enseignant'] ?>"><br>
                        <input class="form-control" type="text" name="etudiantMax"
                               value="<?php echo $formation['nb_etudiants_max'] ?>"><br>

                        <input class="form-check-input" type="checkbox" name="active"
                               value="<?php echo $formation['active'] ?>" <?php echo($formation['active'] ? 'checked' : '') ?>
                        <small> &nbsp;* Actif</small>
                        <br><br>
                    </div>

                    <!---------------PDF------------------>

                    <input type="file" name="pdfFile">

                    <div style="text-align: center">
                        <h3>PDF actuel :</h3>
                        <?php if ($formation['fichier_horaire_pdf']): ?>
                            <p>
                                <a href="uploads/pdfs/<?php echo $formation['fichier_horaire_pdf']; ?>" target="_blank">&#9989;
                                    Voir le
                                    PDF actuel
                                </a>
                            </p>
                            <p>
                                <a href="./uploads/pdfs/<?php echo htmlspecialchars($formation['fichier_horaire_pdf']); ?>"
                                   target="_blank" download> &#9989; Télécharger le fichier horaire</a>
                            </p>
                            <div class="mb-3">
                                <label for="pdfFile" class="form-label"><?php echo $plus ?> Modifier l'horaire :</label>
                                <input class="form-control" type="file" id="pdfFile" name="pdfFile">
                            </div>

                        <?php else: ?>
                            <p>&#10060; Pas de PDF disponible.</p>
                            <div class="mb-3">
                                <label for="pdfFile" class="form-label"> <?php echo $plus ?> ajouter un
                                    horaire:</label>
                                <input class="form-control" type="file" id="pdfFile" name="pdfFile">
                            </div>
                        <?php endif; ?>
                    </div>
                    <!---------------------------------------->

                    <div>
                        <button class="btn btn-primary"><a href="index.php?sent=views/arrayFormations">
                                <?php echo $retour ?>
                                RETOUR
                            </a></button>
                        &nbsp;
                        <button class="btn btn-primary" type="submit">
                            <?php echo $disquette ?>
                            SAUVEGARDER
                        </button>
                    </div>
                </form>

            </div>
            <?php
        }
    }
} else {
    header("Location:index.php?sent=views/authLoginView");
    die;
}
?>

